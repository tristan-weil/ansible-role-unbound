---

##############################################################################
# Configuration
##############################################################################
unbound_default_global_config:
  server:
    interface:
      - 127.0.0.1
      - ::1

    access-control:
      - 0.0.0.0/0 refuse
      - 127.0.0.0/8 allow
      - ::0/0 refuse
      - ::1 allow

    hide-identity: "yes"
    hide-version: "yes"

    # qname-minimisation: "yes"

    # Uncomment to enable DNSSEC validation.
    # auto-trust-anchor-file: "{{ unbound_root_key }}"
    # val-log-level: 2

  # remote-control:
  #   control-enable: "yes"
  #   control-interface: /var/run/unbound.sock

  include: "/etc/unbound/unbound.conf.d/*.conf"

##############################################################################
# Variables
##############################################################################
unbound_pkgs: "{{ __unbound_pkgs_by_distribution[ ansible_facts['distribution'] ] }}"
unbound_config_path: "{{ __unbound_config_path_by_distribution[ ansible_facts['distribution'] ] }}"
unbound_root_key: "{{ __unbound_root_key_by_distribution[ ansible_facts['distribution'] ] }}"
unbound_user: "{{ __unbound_user_by_distribution[ ansible_facts['distribution'] ] }}"
unbound_group: "{{ __unbound_group_by_distribution[ ansible_facts['distribution'] ] }}"

##############################################################################
# Distributions' dictionaries
##############################################################################
__unbound_pkgs_by_distribution:
  Debian:
    - unbound
    - unbound-anchor
  OpenBSD: []

__unbound_config_path_by_distribution:
  Debian: /etc/unbound/unbound.conf
  OpenBSD: /etc/unbound.conf

__unbound_root_key_by_distribution:
  Debian: /var/lib/unbound/root.key
  OpenBSD: /var/unbound/db/root.key

__unbound_user_by_distribution:
  Debian: unbound
  OpenBSD: _unbound

__unbound_group_by_distribution:
  Debian: unbound
  OpenBSD: _unbound
